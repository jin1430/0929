{{> layout/header}}

<section class="cg-section">
    <div class="cg-container">

        <!-- 페이지 헤더 -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">📝 전체 리뷰</h1>
            <p class="text-gray-600">최신 리뷰를 모아봤어요. 카드를 클릭하면 해당 카페 상세 페이지로 이동합니다.</p>
        </div>

        <!-- 리뷰 그리드 -->
        <div class="cg-grid cg-grid-3">
            {{#reviews}}

                <!-- 카드: 본문은 링크, 투표는 링크 밖 -->
                <a href="/cafes/{{cafeId}}"
                   class="cg-card block"
                   style="display:block;text-decoration:none;color:inherit">
                    <!-- 헤더 영역: 카페명/작성자/시간 + 배지 -->
                    <div class="flex items-start justify-between gap-3">
                        <div class="min-w-0">
                            <div class="text-gray-900 font-semibold truncate">{{cafeName}}</div>
                            <div class="small text-gray-500 truncate">by {{memberNickname}} · {{createdAt}}</div>
                        </div>
                        <div class="flex items-center gap-2 shrink-0">
                            {{#rating}}<span class="cg-badge">★ {{rating}}</span>{{/rating}}
                            {{#sentiment}}<span class="cg-badge">{{sentiment}}</span>{{/sentiment}}
                        </div>
                    </div>

                    <!-- 본문 요약: 2줄 말줄임 -->
                    <p class="mt-3 text-gray-700"
                       style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.8em;">
                        {{excerpt}}
                    </p>

                    <!-- 아래 '반응' 블록은 링크 바깥으로 분리 -->
                </a>

                <!-- 반응(색상 원형 버튼) : 기능/카운트 유지 -->
                <div class="mt-3 flex items-center gap-3">
                    <!-- 초록 원형: 좋아요 -->
                    <form method="post" action="/reviews/{{id}}/good" title="좋아요 {{good}}">
                        <button class="cg-dot cg-dot--good" aria-label="좋아요"></button>
                    </form>

                    <!-- 빨강 원형: 아쉬워요 -->
                    <form method="post" action="/reviews/{{id}}/bad" title="아쉬워요 {{bad}}">
                        <button class="cg-dot cg-dot--bad" aria-label="아쉬워요"></button>
                    </form>

                    <!-- (옵션) 카운트 표시: 작게 보이게 -->
                    <span class="small text-gray-500">
                        {{#good}}👍 {{good}}{{/good}}{{#bad}} {{#good}}·{{/good}} 👎 {{bad}}{{/bad}}
                    </span>
                </div>

            {{/reviews}}

            {{^reviews}}
                <div class="small">아직 등록된 리뷰가 없습니다.</div>
            {{/reviews}}
        </div>

        <!-- 페이지네이션 -->
        <div class="mt-8 flex items-center justify-center gap-2">
            {{#hasPrev}}<a class="cg-btn" href="/reviews?page={{prevPage}}&size={{size}}">이전</a>{{/hasPrev}}
            <span class="small">페이지 {{page}} / {{#totalPages}}{{totalPages}}{{/totalPages}}{{^totalPages}}1{{/totalPages}}</span>
            {{#hasNext}}<a class="cg-btn" href="/reviews?page={{nextPage}}&size={{size}}">다음</a>{{/hasNext}}
        </div>

    </div>
</section>

<style>
    /* 색만 보이는 작은 원형 버튼 */
    .cg-dot{ width:20px; height:20px; padding:0; border:none; border-radius:9999px; cursor:pointer; }
    .cg-dot--good{ background:#10b981; }   /* emerald-500 */
    .cg-dot--bad{  background:#ef4444; }   /* red-500 */
    .cg-dot:active{ transform:scale(0.96); }
</style>

{{> layout/footer}}
