{{>layout/header}}

<form id="quiz-form" action="/recommend/questions/result" method="get">

    <main id="page-onboarding" class="bg-gray-50 min-h-screen">
        <section class="py-16">
            <div class="max-w-3xl mx-auto bg-white rounded-2xl p-8 shadow card-shadow">
                <!-- í—¤ë” -->
                <div class="text-center mb-10">
                    <div class="w-16 h-16 primary-gradient rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">â˜•</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">ë‹¹ì‹ ë§Œì˜ ì™„ë²½í•œ ì¹´í˜ë¥¼ ì°¾ì•„ë“œë¦´ê²Œìš”!</h2>
                    <p class="text-gray-600">ëª‡ ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•´ì£¼ì‹œë©´ ì·¨í–¥ì— ë§ëŠ” ì¹´í˜ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤</p>
                </div>

                <!-- ì§„í–‰ í‘œì‹œ -->
                <div class="flex items-center justify-center mb-8">
                    <div class="flex space-x-2" id="step-dots">
                        <div class="w-3 h-3 bg-teal-500 rounded-full step-indicator" data-step="1"></div>
                        <div class="w-3 h-3 bg-gray-300 rounded-full step-indicator" data-step="2"></div>
                        <div class="w-3 h-3 bg-gray-300 rounded-full step-indicator" data-step="3"></div>
                        <div class="w-3 h-3 bg-gray-300 rounded-full step-indicator" data-step="4"></div>
                        <div class="w-3 h-3 bg-gray-300 rounded-full step-indicator" data-step="5"></div>
                    </div>
                    <span class="ml-4 text-sm text-gray-500" id="step-counter">1 / 5</span>
                </div>

                <!-- ì§ˆë¬¸ 1 -->
                <div class="onboarding-step active" id="step-1">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">ì£¼ë¡œ ì¹´í˜ì— ì–´ë–¤ ëª©ì ìœ¼ë¡œ ê°€ì‹œë‚˜ìš”?</h3>
                    <div class="opt-row">
                        <button type="button" class="onboarding-option" data-value="study">
                            <div class="text-4xl mb-2">ğŸ“š</div>
                            <div class="font-medium text-gray-800">ê³µë¶€/ì—…ë¬´</div>
                            <div class="text-sm text-gray-500 mt-1">ì¡°ìš©í•˜ê³  ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ”</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="date">
                            <div class="text-4xl mb-2">ğŸ’•</div>
                            <div class="font-medium text-gray-800">ë°ì´íŠ¸</div>
                            <div class="text-sm text-gray-500 mt-1">ë¶„ìœ„ê¸° ì¢‹ê³  ë¡œë§¨í‹±í•œ</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="friends">
                            <div class="text-4xl mb-2">ğŸ‘¥</div>
                            <div class="font-medium text-gray-800">ì¹œêµ¬ë“¤ê³¼ ìˆ˜ë‹¤</div>
                            <div class="text-sm text-gray-500 mt-1">í™œê¸°ì°¨ê³  í¸ì•ˆí•œ</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="alone">
                            <div class="text-4xl mb-2">â˜•</div>
                            <div class="font-medium text-gray-800">í˜¼ìë§Œì˜ ì‹œê°„</div>
                            <div class="text-sm text-gray-500 mt-1">ì•„ëŠ‘í•˜ê³  í¸ì•ˆí•œ</div>
                        </button>
                    </div>
                </div>

                <!-- ì§ˆë¬¸ 2 -->
                <div class="onboarding-step" id="step-2">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">ì–´ë–¤ ë¶„ìœ„ê¸°ì˜ ì¹´í˜ë¥¼ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h3>
                    <div class="opt-row">
                        <button type="button" class="onboarding-option" data-value="modern">
                            <div class="text-4xl mb-2">ğŸ¢</div>
                            <div class="font-medium">ëª¨ë˜í•˜ê³  ì„¸ë ¨ëœ</div>
                            <div class="text-sm text-gray-500 mt-1">ê¹”ë”í•˜ê³  ë¯¸ë‹ˆë©€í•œ</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="cozy">
                            <div class="text-4xl mb-2">ğŸ </div>
                            <div class="font-medium">ì•„ëŠ‘í•˜ê³  ë”°ëœ»í•œ</div>
                            <div class="text-sm text-gray-500 mt-1">ì§‘ ê°™ì€ í¸ì•ˆí•¨</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="vintage">
                            <div class="text-4xl mb-2">ğŸ“»</div>
                            <div class="font-medium">ë¹ˆí‹°ì§€í•˜ê³  ë…íŠ¹í•œ</div>
                            <div class="text-sm text-gray-500 mt-1">ê°œì„± ìˆê³  íŠ¹ë³„í•œ</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="nature">
                            <div class="text-4xl mb-2">ğŸŒ¿</div>
                            <div class="font-medium">ìì—°ì¹œí™”ì ì¸</div>
                            <div class="text-sm text-gray-500 mt-1">ì‹ë¬¼ê³¼ ìì—° ì†Œì¬</div>
                        </button>
                    </div>
                </div>

                <!-- ì§ˆë¬¸ 3 -->
                <div class="onboarding-step" id="step-3">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">ì¹´í˜ ì„ íƒ ì‹œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†ŒëŠ”?</h3>
                    <div class="opt-row">
                        <button type="button" class="onboarding-option wide" data-value="coffee">
                            <div class="opt-line"><span class="text-2xl mr-3">â˜•</span><span><b>ì»¤í”¼ ë§›ê³¼ í’ˆì§ˆ</b><br><small class="text-gray-500">ìŠ¤í˜ì…œí‹° ì»¤í”¼, ì›ë‘ì˜ í’ˆì§ˆ</small></span></div>
                        </button>
                        <button type="button" class="onboarding-option wide" data-value="atmosphere">
                            <div class="opt-line"><span class="text-2xl mr-3">ğŸµ</span><span><b>ë¶„ìœ„ê¸°ì™€ ì¸í…Œë¦¬ì–´</b><br><small class="text-gray-500">ì˜ˆìœ ê³µê°„, í¬í† ì¡´</small></span></div>
                        </button>
                        <button type="button" class="onboarding-option wide" data-value="location">
                            <div class="opt-line"><span class="text-2xl mr-3">ğŸ“</span><span><b>ì ‘ê·¼ì„±ê³¼ ìœ„ì¹˜</b><br><small class="text-gray-500">êµí†µí¸, ì£¼ì°¨ í¸ì˜ì„±</small></span></div>
                        </button>
                        <button type="button" class="onboarding-option wide" data-value="price">
                            <div class="opt-line"><span class="text-2xl mr-3">ğŸ’°</span><span><b>ê°€ê²© ëŒ€ë¹„ ë§Œì¡±ë„</b><br><small class="text-gray-500">í•©ë¦¬ì ì¸ ê°€ê²©</small></span></div>
                        </button>
                        <button type="button" class="onboarding-option wide" data-value="dessert">
                            <div class="opt-line"><span class="text-2xl mr-3">ğŸ§</span><span><b>ë””ì €íŠ¸ì™€ ìŒì‹</b><br><small class="text-gray-500">ì¼€ì´í¬, ë¸ŒëŸ°ì¹˜ ë©”ë‰´</small></span></div>
                        </button>
                    </div>
                </div>

                <!-- ì§ˆë¬¸ 4 -->
                <div class="onboarding-step" id="step-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">ì£¼ë¡œ ì–¸ì œ ì¹´í˜ë¥¼ ì´ìš©í•˜ì‹œë‚˜ìš”?</h3>
                    <div class="opt-row">
                        <button type="button" class="onboarding-option" data-value="morning">
                            <div class="text-4xl mb-2">ğŸŒ…</div>
                            <div class="font-medium">ì˜¤ì „ (7-11ì‹œ)</div>
                            <div class="text-sm text-gray-500 mt-1">ëª¨ë‹ì»¤í”¼, ë¸ŒëŸ°ì¹˜</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="afternoon">
                            <div class="text-4xl mb-2">â˜€ï¸</div>
                            <div class="font-medium">ì˜¤í›„ (12-17ì‹œ)</div>
                            <div class="text-sm text-gray-500 mt-1">ì ì‹¬ í›„ íœ´ì‹</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="evening">
                            <div class="text-4xl mb-2">ğŸŒ†</div>
                            <div class="font-medium">ì €ë… (18-21ì‹œ)</div>
                            <div class="text-sm text-gray-500 mt-1">í‡´ê·¼ í›„ ì—¬ìœ </div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="weekend">
                            <div class="text-4xl mb-2">ğŸ‰</div>
                            <div class="font-medium">ì£¼ë§</div>
                            <div class="text-sm text-gray-500 mt-1">ì—¬ìœ ë¡œìš´ íœ´ì¼</div>
                        </button>
                    </div>
                </div>

                <!-- ì§ˆë¬¸ 5 -->
                <div class="onboarding-step" id="step-5">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">ì£¼ë¡œ ì–´ëŠ ì§€ì—­ì˜ ì¹´í˜ë¥¼ ì´ìš©í•˜ì‹œë‚˜ìš”?</h3>
                    <div class="opt-row">
                        <button type="button" class="onboarding-option" data-value="hongdae">
                            <div class="text-4xl mb-2">ğŸ¨</div>
                            <div class="font-medium">í™ëŒ€/ì—°íŠ¸ëŸ´íŒŒí¬</div>
                            <div class="text-sm text-gray-500 mt-1">ì Šê³  í™œê¸°ì°¬ ë¶„ìœ„ê¸°</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="hapjeong">
                            <div class="text-4xl mb-2">ğŸ¢</div>
                            <div class="font-medium">í•©ì •</div>
                            <div class="text-sm text-gray-500 mt-1">ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ì‹¬ê°€</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="sangsu">
                            <div class="text-4xl mb-2">ğŸ›ï¸</div>
                            <div class="font-medium">ìƒìˆ˜</div>
                            <div class="text-sm text-gray-500 mt-1">ì „í†µê³¼ í˜„ëŒ€ì˜ ì¡°í™”</div>
                        </button>
                        <button type="button" class="onboarding-option" data-value="anywhere">
                            <div class="text-4xl mb-2">ğŸ—ºï¸</div>
                            <div class="font-medium">ìƒê´€ì—†ìŒ</div>
                            <div class="text-sm text-gray-500 mt-1">ì–´ë””ë“  ì¢‹ì•„ìš”</div>
                        </button>
                    </div>
                </div>

                <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                <div class="btn-row">
                    <button type="button" id="prev-btn" onclick="prevStep()" class="btn-outline hidden">ì´ì „</button>
                    <button type="button" id="complete-btn" onclick="completeOnboarding()" class="btn-primary hidden">ì¹´í˜ ì¶”ì²œë°›ê¸°</button>
                </div>
            </div>
        </section>
    </main>

    <input type="hidden" name="purpose" id="inp-purpose">
    <input type="hidden" name="vibe"    id="inp-vibe">
    <input type="hidden" name="factor"  id="inp-factor">
    <input type="hidden" name="time"    id="inp-time">
    <input type="hidden" name="area"    id="inp-area">
</form>

{{>layout/footer}}

<style>
    .card-shadow{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);}
    .card-shadow:hover{box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04);}
    .opt-row{ display:flex; flex-wrap:wrap; gap:16px 18px; justify-content:center; }
    .onboarding-option{ display:flex; flex-direction:column; align-items:center; text-align:center;
      padding:20px; border:2px solid #e5e7eb; border-radius:16px; background:#fff; min-width:200px; transition:all .2s ease; }
    .onboarding-option:hover{ border-color:#14b8a6; background:#f0fdfa; }
    .onboarding-option.wide{ min-width:280px; align-items:flex-start; text-align:left; }
    .opt-line{ display:flex; align-items:flex-start; }
    .step-indicator.active{ background:#14b8a6; }
    .btn-row{ display:flex; gap:14px; justify-content:center; align-items:center; margin-top:24px; flex-wrap:wrap; }
    .btn-primary{ background:#3aa17e; color:#fff; padding:12px 20px; border-radius:16px; font-weight:600; transition:.2s; }
    .btn-primary:hover{ background:#2d8066; transform:translateY(-1px); }
    .btn-gray{ background:#e5e7eb; color:#4b5563; padding:12px 20px; border-radius:16px; font-weight:600; cursor:not-allowed; }
    .btn-gray.enabled{ cursor:pointer; }
    .btn-outline{ border:1px solid #d1d5db; color:#374151; background:#fff; padding:12px 20px; border-radius:16px; font-weight:600; }
    .btn-outline:hover{ background:#f9fafb; }
    .btn-link{ background:transparent; color:#6b7280; padding:12px 16px; border-radius:12px; }
    .btn-link:hover{ color:#374151; text-decoration:underline; }
    .onboarding-step{ display:none; }
    .onboarding-step.active{ display:block; }
    .onboarding-option.selected{ border-color:#0ea5e9; background:#ecfeff; }
</style>

<script>
    let step = 1, total = 5;

    const mapValue = (step, v) => {
      if (step === 1) return ({study:'work_study', date:'date', friends:'chatting', alone:'solo_coffee'})[v] || v;
      if (step === 2) return ({modern:'modern', cozy:'cozy', vintage:'retro', nature:'nature'})[v] || v;
      return v;
    };

    function writeHidden(stepNum, value){
      const mapped = mapValue(stepNum, value);
      if (stepNum === 1) document.getElementById('inp-purpose').value = mapped;
      if (stepNum === 2) document.getElementById('inp-vibe').value    = mapped;
      if (stepNum === 3) document.getElementById('inp-factor').value  = mapped;
      if (stepNum === 4) document.getElementById('inp-time').value    = mapped;
      if (stepNum === 5) document.getElementById('inp-area').value    = mapped;
    }

    function showStep(n){
      document.querySelectorAll('.onboarding-step').forEach(s => s.classList.remove('active'));
      document.getElementById('step-'+n)?.classList.add('active');
      document.getElementById('step-counter').textContent = n + ' / ' + total;
      document.querySelectorAll('.step-indicator').forEach(dot => {
        const idx = parseInt(dot.dataset.step,10);
        const on = idx <= n;
        dot.classList.toggle('active', on);
        dot.classList.toggle('bg-teal-500', on);
        dot.classList.toggle('bg-gray-300', !on);
      });
      document.getElementById('prev-btn').classList.toggle('hidden', n === 1);
      document.getElementById('next-btn').classList.toggle('hidden', n === total);
      document.getElementById('complete-btn').classList.toggle('hidden', n !== total);
    }

    function nextStep(){ if(step < total){ step++; showStep(step); } }
    function prevStep(){ if(step > 1){ step--; showStep(step); } }

    // ë§ˆì§€ë§‰ ìŠ¤í…ì—ì„œ ì„ íƒ ì¦‰ì‹œ ê²°ê³¼ë¡œ ì´ë™
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.onboarding-option');
      if(!btn) return;
      e.preventDefault();

      const parent = btn.closest('.onboarding-step');
      parent.querySelectorAll('.onboarding-option').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');

      const stepNum = parseInt(parent.id.split('-')[1], 10);
      writeHidden(stepNum, btn.dataset.value);

      if (stepNum < total) {
        // ë‹¤ìŒ ìŠ¤í…ìœ¼ë¡œ
        step = stepNum + 1;
        showStep(step);
      } else {
        // ë§ˆì§€ë§‰ ìŠ¤í…ì´ë©´ ë°”ë¡œ GET ì œì¶œ â†’ /recommend/questions/result?purpose=...&vibe=...
        document.getElementById('quiz-form').submit();
      }
    });

    // í•˜ë‹¨ ë²„íŠ¼ë“¤ì— type="button" í•„ìˆ˜ (ìë™ submit ë°©ì§€)
    // (í…œí”Œë¦¿ ìª½ì—ì„œ ì´ë¯¸ type ì§€ì •í–ˆìœ¼ë©´ ìƒëµ)

    // ì´ˆê¸° í‘œì‹œ
    showStep(1);
</script>