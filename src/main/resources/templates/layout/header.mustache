<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>GoCafe</title>
    <link rel="icon" href="/favicon.ico"/>

    <!-- 공용/컴포넌트/테마 순서 -->
    <link rel="stylesheet" href="/css/tw-shim.css"/>
    <link rel="stylesheet" href="/css/detail.css"/>
    <link rel="stylesheet" href="/css/owner-modal.css"/>
    <link rel="stylesheet" href="/css/alert.css"/>
    <link rel="stylesheet" href="/css/footer.css"/>
    <link rel="stylesheet" href="/css/cafego.css"/>
    <link rel="stylesheet" href="/css/theme-green.css"/>
    <link rel="stylesheet" href="/css/cafes.css"/>

</head>
<body class="{{#isLoggedIn}}is-logged-in{{/isLoggedIn}}">

<nav class="cg-nav">
    <div class="cg-container cg-nav__inner">
        <a href="/" class="cg-brand" aria-label="GoCafe">GoCafe</a>

        <ul class="cg-navlinks cg-navlinks--left">
            <li><a href="/main"       class="{{#isHome}}cg-nav-active{{/isHome}}">홈</a></li>
            <li><a href="/index/map"  class="{{#isMap}}cg-nav-active{{/isMap}}">탐색 지도</a></li>
            <li>
                <a href="/cafes/find">
                    카페 찾기
                </a>
            </li>
            <li><a href="/missions"   class="{{#isMissions}}cg-nav-active{{/isMissions}}">미션</a></li>
            <li><a href="/reviews"    class="{{#isReviews}}cg-nav-active{{/isReviews}}">리뷰</a></li>
        </ul>

        <div class="cg-nav__actions">
            {{^isLoggedIn}}
                <div class="cg-auth-out">
                    <a href="/signup" class="cg-btn-outline">회원가입</a>
                    <a href="/login"  class="cg-btn">로그인</a>
                </div>
            {{/isLoggedIn}}

            {{#isLoggedIn}}
                <div class="cg-auth-in">
                    <span class="cg-me-email">{{currentUserNickname}}님, 환영합니다!</span>
                    <div class="cg-noti">
                        <button id="notiBtn" class="cg-btn-outline" type="button">🔔 <span id="notiCount">{{notificationCount}}</span></button>
                        <div id="notiDropdown" class="cg-dropdown" aria-label="알림 목록">
                            <ul id="notiList" class="cg-dropdown__list"></ul>
                            <div class="cg-dropdown__footer">
                                <button id="notiReadAll" class="cg-btn-outline" type="button">모두 읽음</button>
                            </div>
                        </div>
                    </div>
                    <a href="/member/me" class="cg-btn-outline">마이페이지</a>
                    {{#isAdmin}}<a href="/admin" class="cg-btn-outline">관리자</a>{{/isAdmin}}
                    <form id="logoutForm" action="/api/auth/logout" method="post" style="display:inline;">
                        <button id="logoutBtn" class="cg-btn-outline" type="button">로그아웃</button>
                    </form>
                </div>
            {{/isLoggedIn}}
        </div>
    </div>
</nav>
<script>
    document.getElementById('logoutBtn')?.addEventListener('click', async () => {
      try {
        await fetch('/api/auth/logout', { method: 'POST', credentials: 'include', keepalive: true });
      } finally {
        try {
          localStorage.removeItem('AT'); localStorage.removeItem('RT');
          sessionStorage.removeItem('AT'); sessionStorage.removeItem('RT');
        } catch {}
        location.reload();
      }
    });
</script>
{{#flashInfo}}<div class="cg-flash-info">{{flashInfo}}</div>{{/flashInfo}}
