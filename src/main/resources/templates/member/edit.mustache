{{>layout/header}}

<main class="cg-container mypage">
    <h1 class="cg-title">마이페이지</h1>

    <div class="cg-mypage-grid" id="me-layout">
        <aside>
            <nav class="cg-sidenav">
                <a href="/member/me"       class="{{#nav_me}}is-active{{/nav_me}}">내 정보</a>
                <a href="/member/edit"     class="{{#nav_edit}}is-active{{/nav_edit}}">내 정보 수정</a>
                <a href="/member/reviews"  class="{{#nav_reviews}}is-active{{/nav_reviews}}">내가 쓴 리뷰</a>
                <a href="/member/favorites"       class="{{#nav_favorites}}is-active{{/nav_favorites}}">즐겨찾기 목록 확인</a>
                <a href="/member/needs" class="{{#nav_prefs}}is-active{{/nav_prefs}}">나의 취향</a>
                <a href="/member/withdraw" class="is-danger {{#nav_withdraw}}is-active{{/nav_withdraw}}">회원 탈퇴</a>
            </nav>
        </aside>

        <section>
            {{#member}}
                <form id="editForm" method="post" action="/member/edit" class="cg-form" autocomplete="off">
                    <div class="cg-card" style="margin-bottom:16px;">
                        <div class="cg-card__head"><h2 style="font-size:18px;margin:0;">기본 정보</h2></div>
                        <div class="cg-card__body">
                            <div style="display:flex;gap:24px;align-items:flex-start;flex-wrap:wrap;">
                                <div style="flex:1;min-width:260px;">
                                    <label for="member_nickname">닉네임</label>
                                    <input id="member_nickname" name="member_nickname" value="{{nickname}}" maxlength="8" required>

                                    <label for="member_age" style="margin-top:12px;">나이</label>
                                    <input id="member_age" name="member_age" type="number" value="{{age}}" min="1" max="120">

                                    <label for="member_gender" style="margin-top:12px;">성별</label>
                                    <input id="member_gender" name="member_gender" maxlength="1" value="{{gender}}" placeholder="예: M / F">

                                    <label for="member_photo" style="margin-top:12px;">프로필 사진 파일명</label>
                                    <input id="member_photo" name="member_photo" value="{{photoName}}" placeholder="예: avatar01.png">
                                </div>

                                <div style="width:160px;text-align:center;">
                                    {{#hasPhoto}}
                                        <img src="{{photoUrl}}" alt="현재 프로필" class="cg-avatar-lg">
                                        <div style="margin-top:8px;font-size:12px;color:#6b7280;">현재: {{photoName}}</div>
                                    {{/hasPhoto}}
                                    {{^hasPhoto}}
                                        <div class="cg-avatar-lg" style="background:#e5e7eb;display:flex;align-items:center;justify-content:center;margin:0 auto;">
                                            <span style="font-size:12px;color:#6b7280;">NO IMG</span>
                                        </div>
                                        <div style="margin-top:8px;font-size:12px;color:#6b7280;">현재: 없음</div>
                                    {{/hasPhoto}}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cg-card" style="margin-bottom:16px;">
                        <div class="cg-card__head"><h2 style="font-size:18px;margin:0;">비밀번호 변경 (선택)</h2></div>
                        <div class="cg-card__body">
                            <label for="current_password">현재 비밀번호</label>
                            <input id="current_password" name="current_password" type="password" autocomplete="current-password" placeholder="변경 시에만 입력">

                            <label for="new_password" style="margin-top:12px;">새 비밀번호</label>
                            <input id="new_password" name="new_password" type="password" autocomplete="new-password" placeholder="변경 시에만 입력">
                            <p style="margin-top:8px;font-size:12px;color:#6b7280;">* 현재/새 비밀번호를 모두 입력한 경우에만 비밀번호가 변경됩니다.</p>
                        </div>
                    </div>

                    <div style="display:flex;gap:8px;flex-wrap:wrap;">
                        <button type="submit" class="cg-btn">저장</button>
                        <a href="/member/me" class="cg-btn-ghost">취소</a>
                    </div>
                </form>
            {{/member}}

            {{^member}}
                <div class="cg-card"><div class="cg-card__body">사용자 정보를 불러오지 못했습니다.</div></div>
            {{/member}}
        </section>
    </div>
</main>

{{>layout/footer}}

<!-- PRO 안내 모달 -->
<div id="pro-info-modal" class="cg-modal" aria-hidden="true">
    <div class="cg-modal__backdrop" data-close></div>
    <div class="cg-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="pro-info-title">
        <header class="cg-modal__header">
            <h2 id="pro-info-title">전문 리뷰어 안내</h2>
            <button class="cg-modal__close" type="button" aria-label="닫기" data-close>&times;</button>
        </header>
        <div class="cg-modal__body">
            <section class="cg-panel">
                <header class="cg-panel__head"><h3 class="cg-panel__title">할 수 있는 일</h3></header>
                <div class="cg-panel__body">
                    <ul class="cg-list">
                        <li>플랫폼 미션 신청/수행</li>
                        <li>승인 시 포인트/레벨</li>
                        <li><strong>Pro</strong> 달성 후 <span class="cg-badge is-warning">협찬</span> 미션 참여</li>
                    </ul>
                </div>
            </section>
            <section class="cg-panel">
                <header class="cg-panel__head"><h3 class="cg-panel__title">혜택</h3></header>
                <div class="cg-panel__body">
                    <ul class="cg-list">
                        <li>Pro 전용 협찬 미션 지원 자격</li>
                        <li>프로필 Pro 뱃지</li>
                        <li>추천 미션 우선 초대</li>
                    </ul>
                    <p class="cg-note">Pro 기준: 승인 리뷰 10건 이상 & GOOD 6건 이상.</p>
                </div>
            </section>
        </div>
        <footer class="cg-modal__footer">
            <a class="cg-btn" href="/missions">미션 보러가기</a>
            <button class="cg-btn-outline" type="button" data-close>닫기</button>
        </footer>
    </div>
</div>

<!-- 페이지 전용 스타일 -->
<style>
    :root{
      --primary-mint:#3aa17e; --primary-mint-dark:#2d8066;
      --gray-50:#fafafa; --gray-100:#f3f4f6; --gray-200:#e5e7eb; --gray-600:#4b5563; --gray-700:#374151; --gray-800:#1f2937;
    }
    .cg-container{max-width:1100px;margin:0 auto;padding:32px 16px;}
    .cg-title{font-size:36px;font-weight:800;color:var(--gray-800);margin-bottom:12px;}
    .cg-mypage-grid{display:grid;grid-template-columns:260px 1fr;gap:24px;align-items:start;}
    @media (max-width:1024px){.cg-mypage-grid{grid-template-columns:1fr}}
    /* 사이드 내비 */
    .cg-sidenav{position:sticky;top:84px;display:flex;flex-direction:column;gap:8px;background:#fff;border:1px solid var(--gray-200);border-radius:14px;padding:14px}
    .cg-sidenav a{display:block;padding:10px 12px;border-radius:10px;color:var(--gray-700);font-weight:600}
    .cg-sidenav a:hover{background:var(--gray-100)}
    .cg-sidenav a.is-active{background:rgba(58,161,126,.1);color:var(--primary-mint)}
    .cg-sidenav a.is-danger{color:#b91c1c}
    /* 패널 */
    .cg-panel{background:#fff;border:1px solid var(--gray-200);border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.04);margin-bottom:20px}
    .cg-panel__head{display:flex;justify-content:space-between;align-items:center;padding:18px 20px;border-bottom:1px solid var(--gray-200)}
    .cg-panel__title{font-size:20px;font-weight:800;color:var(--gray-800)}
    .cg-eyebrow{font-size:12px;color:var(--gray-600);margin-bottom:4px}
    .cg-panel__body{padding:18px 20px}
    .cg-head-actions{display:flex;gap:8px;flex-wrap:wrap}
    /* 배지/아바타 */
    .cg-badges{display:flex;gap:8px;flex-wrap:wrap}
    .cg-badge{background:#eefcf6;border:1px solid rgba(58,161,126,.25);color:var(--primary-mint);padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .cg-badge.is-warning{background:#fff7ed;border-color:#fdba74;color:#c2410c}
    .cg-avatar-lg{width:72px;height:72px;border-radius:50%;object-fit:cover}
    .cg-avatar-ring{box-shadow:0 0 0 3px rgba(58,161,126,.2)}
    .cg-avatar-empty{background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#6b7280;font-size:12px}
    .cg-profile{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    /* 키밸류 */
    .cg-kv{display:grid;grid-template-columns:140px 1fr;gap:10px 16px;align-items:center}
    .cg-kv dt{color:var(--gray-600)}
    .cg-divider{height:1px;background:var(--gray-200);margin:16px 0}
    /* KPI & Progress */
    .cg-kpi-row{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
    .cg-kpi{min-width:96px;text-align:center}
    .cg-kpi__value{font-size:20px;font-weight:800;color:var(--gray-800)}
    .cg-kpi__label{font-size:12px;color:var(--gray-600)}
    .cg-progress{height:10px;background:var(--gray-200);border-radius:999px;overflow:hidden;margin-top:12px}
    .cg-progress__bar{height:100%;background:var(--primary-mint)}
    .cg-note{margin-top:8px;color:var(--gray-700)}
    .cg-note.muted{color:#6b7280}
    .cg-notice-panel{background:#f0fdf9;border:1px solid #99f6e0;color:#065f46;padding:12px;border-radius:12px}
    /* 버튼 */
    .cg-btn{height:40px;padding:0 14px;background:var(--primary-mint);color:#fff;border-radius:10px;font-weight:700;border:0}
    .cg-btn:hover{background:var(--primary-mint-dark)}
    .cg-btn-outline{height:40px;padding:0 14px;border:1px solid var(--primary-mint);color:var(--primary-mint);border-radius:10px;font-weight:700;background:#fff}
    .cg-btn-outline:hover{background:rgba(58,161,126,.06)}
    /* 모달 */
    .cg-modal{position:fixed;inset:0;display:none;z-index:1000}
    .cg-modal.is-open{display:block}
    .cg-modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.4)}
    .cg-modal__dialog{position:relative;margin:6vh auto;max-width:760px;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.2);padding:16px}
    .cg-modal__header{display:flex;justify-content:space-between;align-items:center}
    .cg-modal__close{background:none;border:0;font-size:28px;line-height:1;cursor:pointer}
</style>

<script>
    (function(){
      const modal=document.getElementById('pro-info-modal');
      const btn=document.getElementById('btn-open-pro-info');
      if(!modal||!btn) return;
      const open=()=>modal.classList.add('is-open');
      const close=()=>modal.classList.remove('is-open');
      btn.addEventListener('click',open);
      modal.querySelectorAll('[data-close]').forEach(el=>el.addEventListener('click',close));
      document.addEventListener('keydown',e=>{ if(e.key==='Escape') close(); });
    })();
</script>
