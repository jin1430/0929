{{>layout/header}}
<style>
    /* ì•ˆë‚´ íŒ¨ë„ì„ ìœ„í•œ ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ */
    .cg-notice-panel {
        margin: 24px 0 0 0;
        padding: 16px 20px;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        background-color: #f8fafc;
    }
    .cg-notice-panel strong {
        font-size: 16px;
    }
    .cg-notice-panel p {
        margin: 4px 0 0 0;
        font-size: 14px;
        color: #64748b;
    }
    /* ê±°ì ˆ ìƒíƒœì¼ ë•Œë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ */
    .cg-notice-panel.is-danger {
        border-color: #fecaca;
        background-color: #fef2f2;
        color: #991b1b;
    }
    .cg-notice-panel.is-danger p {
        color: #b91c1c;
    }
</style>

<main class="cg-container" {{#cafe}}data-cafe-id="{{id}}"{{/cafe}}>

    {{#cafe}}
        {{#isPending}}
            <div class="cg-notice-panel">
                <strong>â³ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì¹´í˜ì…ë‹ˆë‹¤.</strong>
                <p>ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ìì˜ ìŠ¹ì¸ í›„ ì‚¬ì´íŠ¸ì— ì •ì‹ìœ¼ë¡œ ë…¸ì¶œë©ë‹ˆë‹¤. ìŠ¹ì¸ê¹Œì§€ëŠ” 1~2 ì˜ì—…ì¼ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        {{/isPending}}
        {{#isRejected}}
            <div class="cg-notice-panel is-danger">
                <strong>ğŸš« ë°˜ë ¤ëœ ì¹´í˜ ë“±ë¡ ìš”ì²­ì…ë‹ˆë‹¤.</strong>
                <p>ì´ í˜ì´ì§€ëŠ” ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë“±ë¡ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
            </div>
        {{/isRejected}}
    {{/cafe}}
<main class="cg-container" {{#cafe}}data-cafe-id="{{id}}"{{/cafe}}>

    <!-- ===== Hero (ì¢Œ: ë©”ì¸ ì‚¬ì§„ / ìš°: ì •ë³´) ===== -->
    <section class="cg-hero">
        {{#cafe}}
            <div class="cg-hero__inner">
                <!-- ì¢Œì¸¡: ë©”ì¸ ì‚¬ì§„ -->
                <div class="cg-hero__left">
                    <div class="cg-hero__imgwrap">
                        {{#mainPhoto}}
                            <img class="cg-card__img" src="{{url}}" alt="{{cafe.name}}"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');">
                        {{/mainPhoto}}
                        {{^mainPhoto}}
                            <img class="cg-card__img" src="/images/placeholder-cafe.jpg" alt="ì´ë¯¸ì§€ ì—†ìŒ"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');">
                        {{/mainPhoto}}
                    </div>
                </div>

                <!-- ìš°ì¸¡: ì œëª©/ë©”íƒ€/ì •ë³´/íƒœê·¸/ë²„íŠ¼ -->
                <div class="cg-hero__right">
                    <h1 class="cg-title" style="margin:0 0 8px 0">{{name}}</h1>

                    <div class="cg-hero__meta" style="margin-bottom:12px;display:flex;gap:8px;color:#64748b">
                        {{#views}}<span>ì¡°íšŒìˆ˜ {{views}}</span>{{/views}}{{^views}}<span>ì¡°íšŒìˆ˜ 0</span>{{/views}}
                        <span class="cg-dot">Â·</span>
                        {{#dateFmt}}<span>ë“±ë¡ {{dateFmt}}</span>{{/dateFmt}}{{^dateFmt}}<span>ë“±ë¡ {{date}}</span>{{/dateFmt}}
                        <span class="cg-dot">Â·</span>
                        <span>ì¢‹ì•„ìš” {{cafeGood}} / ì•„ì‰¬ì›Œìš” {{cafeBad}}</span>
                    </div>

                    <div class="cg-info-plain">
                        <dl class="cg-dl">
                            <div class="cg-dl__row"><dt>ì£¼ì†Œ</dt><dd>{{address}}</dd></div>
                            <div class="cg-dl__row"><dt>ì „í™”ë²ˆí˜¸</dt><dd>{{number}}</dd></div>
                        </dl>
                    </div>

                    <!-- íƒœê·¸ ì¹© -->
                    <div class="cg-chips" style="display:flex;flex-wrap:wrap;gap:8px;margin:12px 0">
                        {{#cafeTags}}
                            <button class="cg-chip" data-category="{{cafe.code}}" data-tag="{{code}}">
                                {{code}}{{#count}}<small class="cg-badge">{{count}}</small>{{/count}}
                            </button>
                        {{/cafeTags}}
                        {{^cafeTags}}<span class="cg-empty">ë“±ë¡ëœ íƒœê·¸ê°€ ì—†ì–´ìš”.</span>{{/cafeTags}}
                    </div>

                    <!-- ì£¼ìš” ì•¡ì…˜ -->
                    <div class="cg-actions" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                        <a class="cg-btn-outline" href="tel:{{number}}">ì „í™”í•˜ê¸°</a>
                        <a class="cg-btn-outline" target="_blank"
                           href="https://map.kakao.com/link/to/{{name}},{{lat}},{{lon}}">ê¸¸ì°¾ê¸°</a>
                        <a class="cg-btn"
                           href="#"
                           data-review-modal
                           data-cafe-id="{{id}}">ë¦¬ë·° ì‘ì„±</a>

                        <button id="favBtn"
                                class="cg-btn-outline"
                                data-cafe-id="{{id}}"
                                data-favorited="{{isFavorited}}">
                            {{#isFavorited}}ì¦ê²¨ì°¾ê¸° í•´ì œ{{/isFavorited}}{{^isFavorited}}ì¦ê²¨ì°¾ê¸°{{/isFavorited}}
                        </button>

                        <span id="favCount" style="margin-left:6px">
              {{#favoriteCount}}ì¦ê²¨ì°¾ê¸° {{favoriteCount}}{{/favoriteCount}}{{^favoriteCount}}ì¦ê²¨ì°¾ê¸° 0{{/favoriteCount}}
            </span>

                        {{#isOwner}}
                            <a class="cg-btn-outline" href="/cafes/{{id}}/edit">ì •ë³´ ìˆ˜ì •</a>
                            <form method="post" action="/cafes/{{id}}/delete" style="display:inline">
                                {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                <button class="cg-btn-outline" type="submit" onclick="return confirm('ì‚­ì œí•˜ì‹œê² ì–´ìš”?')">ì‚­ì œ</button>
                            </form>
                        {{/isOwner}}
                    </div>
                </div>
            </div>
        {{/cafe}}
    </section>

    <!-- ===== ì˜ì—… ì •ë³´ / ì†Œê°œ ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>ì˜ì—… ì •ë³´</h3></div>
        <div class="cg-grid2">
            <div class="cg-card"><div class="cg-card__body">
                {{#info}}
                    <dl class="cg-dl">
                        <div class="cg-dl__row"><dt>ì˜¤í”ˆ</dt><dd>{{cafeOpenTime}}</dd></div>
                        <div class="cg-dl__row"><dt>ë§ˆê°</dt><dd>{{cafeCloseTime}}</dd></div>
                        <div class="cg-dl__row"><dt>íœ´ë¬´ì¼</dt><dd>{{cafeHoliday}}</dd></div>
                    </dl>
                {{/info}}
                {{^info}}<div class="cg-empty">ì˜ì—… ì •ë³´ê°€ ì•„ì§ ì—†ì–´ìš”.</div>{{/info}}
            </div></div>

            <div class="cg-card"><div class="cg-card__body">
                {{#info}}
                    {{#cafeNotice}}<div class="cg-note"><strong>ê³µì§€</strong> {{cafeNotice}}</div>{{/cafeNotice}}
                    {{#cafeInfo}}<p class="cg-desc">{{cafeInfo}}</p>{{/cafeInfo}}
                    {{^cafeNotice}}{{^cafeInfo}}<div class="cg-empty">ì†Œê°œ/ê³µì§€ ì •ë³´ê°€ ì•„ì§ ì—†ì–´ìš”.</div>{{/cafeInfo}}{{/cafeNotice}}
                {{/info}}
                {{^info}}<div class="cg-empty">ì†Œê°œ/ê³µì§€ ì •ë³´ê°€ ì•„ì§ ì—†ì–´ìš”.</div>{{/info}}
            </div></div>
        </div>
    </section>

    <!-- ===== ìœ„ì¹˜(ì§€ë„) ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>ìœ„ì¹˜</h3></div>
        <div class="cg-card"><div class="cg-card__body">
            {{#cafe}}
                <div id="map" class="cg-map" data-lat="{{lat}}" data-lon="{{lon}}" data-name="{{name}}">
                    <div class="cg-empty">ì§€ë„ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
            {{/cafe}}
        </div></div>
    </section>

    <!-- ===== ë©”ë‰´ ===== -->
    <section class="cg-section">
        <div class="cg-section__head">
            <h3>ë©”ë‰´</h3>
            {{#cafe}}<a class="cg-link" href="/cafes/{{id}}/menu">ì „ì²´ ë©”ë‰´</a>{{/cafe}}
        </div>
        <ul class="cg-card-grid">
            {{#menus}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{menuPhoto}}" alt="{{menuName}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');" />
                    </div>
                    <div class="cg-card__body">
                        <div class="cg-card__title">{{menuName}}</div>
                        <div class="cg-card__meta">{{menuPrice}}</div>
                    </div>
                </li>
            {{/menus}}
            {{^menus}}<li class="cg-empty">ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ì–´ìš”.</li>{{/menus}}
        </ul>
    </section>

    <!-- ===== ë°©ë¬¸ì ë¦¬ë·° ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>ë°©ë¬¸ì ë¦¬ë·°</h3></div>
        <ul class="cg-feed">
            {{#reviews}}
                <li class="cg-feed__item">
                    <p class="cg-feed__text">{{content}}</p>

                    <div class="cg-feed__photos" data-review-photos>
                        {{#photos}}
                            <img class="cg-feed__photo" src="{{photoUrl}}" alt="ë¦¬ë·° ì‚¬ì§„" loading="lazy"
                                 onerror="this.style.display='none'"/>
                        {{/photos}}
                        <span class="cg-feed__photo-count" hidden></span>
                    </div>

                    <div class="cg-feed__meta">
                        <span>{{createdAtFmt}}</span>
                        <span>ì¢‹ì•„ìš” {{good}} / ì•„ì‰¬ì›Œìš” {{bad}}</span>
                        {{#memberNickname}}<span class="cg-dot">Â·</span><span>{{memberNickname}}</span>{{/memberNickname}}
                    </div>
                </li>
            {{/reviews}}
            {{^reviews}}<li class="cg-empty">ì•„ì§ ë¦¬ë·°ê°€ ì—†ë„¤ìš”.</li>{{/reviews}}
        </ul>
    </section>


    <!-- ===== ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ (ì˜µì…˜: ëª¨ë¸ì— cafePhotos ìˆì„ ë•Œ) ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>ì‚¬ì§„</h3></div>
        <ul class="cg-card-grid">
            {{#cafePhotos}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{cafePhotoUrl}}" alt="{{#cafe}}{{name}}{{/cafe}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');" />
                    </div>
                </li>
            {{/cafePhotos}}
            {{^cafePhotos}}<li class="cg-empty">ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ì–´ìš”.</li>{{/cafePhotos}}
        </ul>
    </section>

</main>

<!-- ===========================
     ëª¨ë‹¬ (ë¦¬ë·° ì‘ì„±) â€“ ê¸°ì¡´ ìœ ì§€
     =========================== -->
<style>
    /* ëª¨ë‹¬: ê¸°ë³¸ ìˆ¨ê¹€, is-open ë•Œë§Œ í‘œì‹œ */
    .cg-modal{position:fixed;inset:0;display:none;z-index:1000}
    .cg-modal.is-open{display:grid}
    .cg-modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .cg-modal__dialog{position:relative;width:100%;height:100%;display:grid;place-items:center;padding:20px;pointer-events:none}
    .cg-modal__sheet{width:min(720px,96vw);max-height:88vh;background:#fff;border-radius:16px;overflow:auto;pointer-events:auto}
    .cg-modal__header,.cg-modal__footer{padding:16px 20px}
    .cg-modal__content{padding:0 20px 16px}
    .cg-modal__title{margin:0;font-size:20px}
    .cg-modal__close{border:0;background:transparent;font-size:28px;line-height:1;cursor:pointer;margin-left:auto}
    body.cg-modal-open{overflow:hidden}
</style>

<div id="reviewModal" class="cg-modal" aria-hidden="true" role="dialog" aria-labelledby="reviewModalTitle">
    <div class="cg-modal__backdrop" data-close-modal></div>
    <div class="cg-modal__dialog">
        <form id="reviewForm" class="cg-modal__sheet" method="post" action="/reviews/new" enctype="multipart/form-data" novalidate>
            {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
            <input type="hidden" name="cafeId" id="modalCafeId"/>

            <div class="cg-modal__header" style="display:flex;gap:8px;align-items:center">
                <h3 id="reviewModalTitle" class="cg-modal__title">ë¦¬ë·° ì‘ì„±</h3>
                <button type="button" class="cg-modal__close" aria-label="ë‹«ê¸°" data-close-modal>&times;</button>
            </div>

            <div class="cg-modal__content">
                <label class="cg-label">ë‚´ìš©</label>
                <textarea name="reviewContent" class="cg-input" rows="8" style="min-height:160px" placeholder="ë°©ë¬¸ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”." required maxlength="1000" autofocus aria-required="true"></textarea>

                <label class="cg-label" style="margin-top:12px">ì „ë°˜ì  ë§Œì¡±ë„</label>
                <div class="cg-toggle2" role="group" aria-label="ì „ë°˜ì  ë§Œì¡±ë„">
                    <label class="cg-toggle2__btn">
                        <input type="radio" name="sentiment" value="GOOD" checked>
                        <span>ì¢‹ì•„ìš”</span>
                    </label>
                    <label class="cg-toggle2__btn">
                        <input type="radio" name="sentiment" value="BAD">
                        <span>ì•„ì‰¬ì›Œìš”</span>
                    </label>
                </div>

                <label class="cg-label" style="margin-top:12px">ì´ëŸ° ì ì´ ì¢‹ì•˜ì–´ìš” (ë³µìˆ˜ì„ íƒ)</label>
                <div class="cg-chips">
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ë§›ìˆì–´ìš”"> ìŒì‹ì´ ë§›ìˆì–´ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ì¹œì ˆí•´ìš”"> ì¹œì ˆí•´ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ì¸í…Œë¦¬ì–´"> ì¸í…Œë¦¬ì–´ê°€ ë©‹ì ¸ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ì‹ ì„ í•œì¬ë£Œ"> ì¬ë£Œê°€ ì‹ ì„ í•´ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="íŠ¹ë³„í•œë©”ë‰´"> íŠ¹ë³„í•œ ë©”ë‰´ê°€ ìˆì–´ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ê¸°ë³¸ì•ˆì£¼"> ê¸°ë³¸ ì•ˆì£¼ê°€ ì¢‹ì•„ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ìŒì•…"> ìŒì•…ì´ ì¢‹ì•„ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="í˜¼ìˆ "> í˜¼ìˆ í•˜ê¸° ì¢‹ì•„ìš”</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="ê°€ì„±ë¹„"> ê°€ì„±ë¹„ê°€ ì¢‹ì•„ìš”</label>
                </div>

                <label class="cg-label" style="margin-top:12px">ì‚¬ì§„ (ì„ íƒ)</label>
                <input id="photoInput" class="cg-sr-only" type="file" name="photos" accept="image/*" multiple>
                <label for="photoInput" class="cg-btn-outline">íŒŒì¼ ì„ íƒ</label>
                <small class="cg-help">ìµœëŒ€ 5ì¥, ì´ë¯¸ì§€ë‹¹ 10MB ì´í•˜ ê¶Œì¥</small>
            </div>

            <div class="cg-modal__footer" style="display:flex;justify-content:flex-end;gap:8px">
                <button type="button" class="cg-btn-outline" data-close-modal>ì·¨ì†Œ</button>
                <button type="submit" class="cg-btn">ë“±ë¡</button>
            </div>
        </form>
    </div>
</div>

{{>layout/footer}}