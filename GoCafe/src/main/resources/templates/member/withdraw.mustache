{{>layout/header}}

<main class="cg-container mypage" style="padding:24px 0">
    <h1 class="cg-title">회원 탈퇴</h1>

    <div class="cg-mypage-grid">
        <aside>
            <nav class="cg-sidenav">
                <a href="/member/me">내 정보</a>
                <a href="/member/edit">내 정보 수정</a>
                <a href="/reviews/mine">내가 쓴 리뷰</a>
                <a href="/favorites">즐겨찾기 목록 확인</a>
                <a href="/member/withdraw" class="is-danger is-active">회원 탈퇴</a>
            </nav>
        </aside>

        <section>
            <div class="cg-card">
                <div class="cg-card__body">
                    <p>계정 <b>{{email}}</b> 을(를) 정말로 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.</p>

                    <div style="margin-top:16px;">
                        <button id="btnWithdraw" class="cg-btn" style="background:#dc2626;">탈퇴하기</button>
                        <a href="/member/me" class="cg-btn-ghost" style="margin-left:8px;">취소</a>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<script>
    document.getElementById('btnWithdraw')?.addEventListener('click', async () => {
      if(!confirm('정말 탈퇴하시겠습니까? 되돌릴 수 없습니다.')) return;
      const token = localStorage.getItem('accessToken'); // 저장 키 이름 맞게 조정
      const res = await fetch('/member/withdraw', {
        method: 'DELETE', // 서버에 맞게 POST로 바꿔도 됨
        headers: {
          'Authorization': token ? `Bearer ${token}` : '',
          'Content-Type': 'application/json'
        }
      });
      if (res.ok) {
        // 서버 정책에 맞게 후처리
        window.location.href = '/logout';
      } else {
        alert('탈퇴 처리에 실패했습니다.');
      }
    });
</script>

{{>layout/footer}}
